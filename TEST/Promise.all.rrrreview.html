<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 2021-10-25
      // Promise.all
      // 作用：将多个promise实例包装成一个promise实例，返回一个新的promise对象
      // 参数：
      //  - 数组：成员必须是 promise实例对象；如果不是则会通过 Promise.resolve() 将其他类型的数据转成 promise对象
      //  - Iterator接口：成员必须是 promise 实例对象
      // 返回值
      // - 一个新的promise对象
      // 特点
      // 1. 所有fulfilled，整个状态fulfilled
      // 2. 一个rejected，整个状态rejected

      const p1 = Promise.resolve("p1");
      const p2 = Promise.resolve("p2");
      const p3 = Promise.reject("p3");
      const str4 = "str4";

      Promise.all2 = (promiseList) => {
        return new Promise((resolve, reject) => {
          const result = [];
          const promiseArr = Array.from(promiseList);
          promiseArr.forEach((_promise) => {
            Promise.resolve(_promise).then((promiseValue) => {
              result.push(promiseValue);
              if (result.length === promiseArr.length) {
                resolve(result);
              }
            }, reject);
          });
        });
      };

      Promise.all([p1, p2, p3, str4])
        .then((pList) => console.log(`原生`, pList))
        .catch((err) => console.log(`原生err`, err));

      Promise.all2([p1, p2, p3, str4])
        .then((pList) => console.log(`手写`, pList))
        .catch((err) => console.log(`手写err`, err));
    </script>
  </body>
</html>
