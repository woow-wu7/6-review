# http

### (1) http 相关概念

- 含义
  - http 是 超文本传输协议，除了传输文本，还能传输图片，视频等资源
    - ht -> hyperText 超过 高 文本
    - t -> transfer 传输
    - p -> protocol
    - hyperText transfer protocol 超文本传输协议

### (2) tcp/ip 协议

- 分层
  - 应用层：http
  - 传输层：tcp udp
  - 网络层：ip
  - 数据链路层

### (3) tcp 报文

- 相关概念
  - 序号 Seq
  - 确认号 Ack
  - 标识位
    - ACK 确认
    - SYN 建立链接
    - FIN 释放链接
  - Ack = Seq + 1
  - 只有标识为 ACK=1 时，确认序号 Ack 字段才有效

### (4) tcp 三次握手 --- 由客户端发起

- 1. 客户端 -> 服务器端
  - 链接包：标志位 SYN=1，序号 Seq=x 的链接包
  - 发送后的状态：close -> syn_sent
  - 判断：服务器能判断 客户端的发送能力，自己的接收能力正常
- 2. 服务器端 -> 客户端
  - 确认包：标志位 SYN=1，ACK=1，确认号 Ack=x+1，序号 Seq=y 的确认包
  - 发送后的状态：close -> syn_received
  - 判断：客户端能判断 服务器的接收发送能力正常，自己的发送接收能力正常
- 3. 客户端 -> 服务器
  - 确认包：标志位 ACK=1，确认号 Ack=y+1，序号 Seq=x+1 的确认包
  - 发送后两者的状态都变成 established
  - 判断：服务器能判断 客户端的发送接收能力正常，自己的接收发送能力正常

### (5) tcp 四次挥手 --- 客户端和服务端都能发起

- 1. 客户端 -> 服务器端
  - 释放包：标志位 FIN=1，序号 Seq=u 的释放链接给服务器
  - 发送后的状态：客户端 established->finWait1 服务器 established->close_wait
  - 表明：客户端的报文发送完毕，但是还可以接收报文
- 2. 服务器 -> 客户端
  - 确认包：标志位 ACK=1，确认号 Ack=u+1，序号 Seq=v
  - 发送后的状态：服务器有 established->close_wait
- 3. 服务器 -> 客户端
  - 释放包：标志位 FIN=1，ACK=1，确认号 Ack=u+1，序号 Seq=w 的释放请求给客户端
  - 发送后的状态：服务器端 closeWait->lastAck
  - 表明：服务器报文发送完毕，但是服务器还可以接收报文
- 4. 客户端 -> 服务器
  - 确认包：标志位 ACk=1，确认号 Ack=w+1，序号 Seq=u+1
  - 发送后的状态：客户端进入 timeWait，timeWait 的时间至少是一个报文的 ( 来回时间 )

### (6) 一些重要的 http 状态码

- 100 continue 继续请求
- 101 switch protocol 客户端应该升级协议
- 200 ok
- 201 created post 请求资源创建成功
- 204 no content 请求成功，但是没有资源可以返回
- 206 partial content 范围请求
- 301 moved permanently 永久重定向
- 302 found 临时重定向
- 303 sea other 临时重定向，应该用 get
- 304 not modified 资源未被修改
- 307 temporary redirect 临时重定向
- 400 bad request
- 401 unauthorized 未授权
- 403 forbidden 禁止访问
- 404 not found 资源未找到
- 405 method not allow 请求方法错误
- 500 internal server error
- 502 bad Gateway 网关错误
- 503 service Unavailable 服务器过载
- 504 gateway time out 网关超时

### (7) http 的特点

- 缺点
  - 明文传播 ---------------> 窃听
  - 不验证通信双方的 身份 ----> 伪装 --------> 请求和响应都不会对通信双方的身份进行确认
  - 不验证报文的 完整性 ------> 篡改

### (8) 加密的对象有哪些

- 通信线路 的加密 -----------> http + ssl
- 通信内容 的加密

### (9) 常见的加密算法

- 总体上分为 可逆加密 和 不可逆加密

```
1. 可逆加密
- MD5，SHA
- SHA 是安全散列算法
- 由于这些加密都是不可逆的，因此比较常用的场景就是用户密码加密，其验证过程就是通过比较两个加密后的字符串是否一样来确认身份的


2. MD5加密的特点
- 压缩性：无论数据的长度是多少，MD5加密计算出来的值 ( 长度相同 )
- 容易计算性：由 原数据 容易计算出 MD5的值
- 抗修改性：即便只修改一个字符，计算出来的MD5值也差异巨大
- 抗碰撞性：知道数据和`MD5`值，很小概率找到相同`MD5`值相同的原数据
```

### (10) HTTP 报文

- 组成
  - 报文首部
  - 空行
  - 报文主体
- 请求报文首部 = 请求行 + 请求头
- 响应报文首部 = 状态行 + 响应头
- ( `请求报文 = 报文首部 + 空行 + 报文主体` )
- ( `请求报文 = 请求行 + 请求头 + 空行 + 报文主体` )

```
1. 请求报文
- 请求报文 = 报文首部 + 空行 + 报文主体
  - 请求报文首部 = 请求行 + 请求头
  - 响应博文首部 = 状态行 + 响应头

2. 报文首部
- 请求报文首部 = 请求行 + 请求头
- 响应博文首部 = 状态行 + 响应头

3. 请求行
- 请求行 = 请求的方法 + 请求的URI + HTTP的版本号

4. 状态行
- 状态行 = HTTP版本号 + 状态码 + 原因短语
```

### (11) HTTPS

- 1. 概念
  - 通常 http 直接和 tcp 通信，当使用 ssl 时，变成了 http -> ssl -> tcp
  - 采用 ssl 后，http 就拥有了 https 的加密，证书，完整性保护的功能
- 2. 对称加密 和 非对称加密
  - 对称加密
    - 通信双方使用 ( 同一个密钥 )
  - 非对称加密
    - 非对称加密有两个密钥 ( 公钥 - 可以转交给任何人 ) 和 ( 私钥 - 非公开 )
    - `公钥加密，私钥解`
    - `私钥加密，公钥解`
- 3. HTTPS 采混合加密的方式，即同时采用 ( 对称加密 和 非对称加密 )
  - 混合加密
    - 在交换密钥环节：使用非对称加密，即 ( `使用非对称加密方式加密-对称加密通信时需要用到的密钥` ) ----- 保证安全，牺牲效率
    - 在之后的通信环节：使用对称加密方式通信 --------------------------------------------------- 提高效率
    - 注意：非对称加密的速度要比对称加密 ( 慢 )，所以各有优势
- 4. 问题
  - 问题：如何保证 非对称加密的 公钥 的安全性？
  - 回答：证书结构，办法公钥证书

### (12) 数字证书 - 认证机构数字证书业务流程

```
证书颁发结构认证证书的流程
----

1. 前置知识
- 服务器：有一对密钥，一个公钥 一个私钥
- 证书颁发机构：也有一对密钥，一个公钥，一个私钥
- 证书颁发机构的 ( 公钥 ) 内置在 ( 浏览器 ) 中

2. 具体流程
- 1 ( 服务器 ) 将自己的 ( 公钥 ) 给到证书颁发机构
- 2 ( 证书颁发机构 ) 用自己的 ( 私钥 ) 加密 ( 服务器的公钥 )，生成 ( 公钥证书 )
- 3 ( 服务器 ) 将 ( 证书机构颁发的服务器的合法的 - 公钥证书 ) 发给 ( 客户端 )
- 4 ( 客户端 ) 用 ( 内置在浏览器中的 - 证书颁发机构的公钥 ) 解密 ( 公钥证书 )，从而证明 ( 服务器的公钥合法有效 )
- 5 ( 客户端 ) 就可以用 ( 服务器的公钥 ) 来加密 ( 对称密钥通信时-需要用到的密钥 )，再发给服务器
- 6 ( 服务器 ) 用自己的 ( 私钥 ) 解密，获取到 ( 对称加密通信时需要用到的 - 密钥 )
- 7 之后双方就可以进行对称加密通信了
```

### (13) HTTPS 的通信过程

```
HTTPS 的通信过程 - 一共12次握手
---

1. 前置知识
- certificate 证书
- cipher 密码
- spec 规格
- handshake 握手


---
2. https通信的具体流程
--> client hello

<-- server hello
<-- certificate
<-- serverHelloDone

--> clientKeyExchange
--> changeCipherSpec
--> finished

<-- changeCipherSpec
<-- finished

--> 请求
<-- 响应
```

### (14) HTTP1.0 和 HTTP1.1 的区别？

- HTTP 1.0

```
HTTP 1.0
- 无状态：不记录请求过的状态
- 无连接：每次请求都要重新建立链接

无状态
- 可以通过 session/cookie 来保存请求状态，从而记录身份和登录状态

无连接
- 无连接表示的是：每次发起请求都要重新建立连接，缺点如下
  - 无法复用连接
  - 造成对头阻塞：即只有等到前一个请求响应到达后，才能发起下一个请求，如果前一个请求阻塞，后面的请求将阻塞
```

- HTTP 1.1

```
HTTP1.1 主要就是要解决HTTP1.0的无状态无连接的两个缺陷

HTTP1.1的特性
- 长链接
- 管道化
- 缓存
- 断点续传


(1) 长连接
- HTTP1.1在数据传输完成后，连接不断开，继续用该 ( 通道 ) 传输数据
- 响应头：Connection: Keep-Alive
- 响应头：Keep-Alive: timeout=5, max=1000
  - timeout 长连接的保持时间
  - max 关闭连接前的可以发送请求的最大值
- 总结：两个响应头 ( Connection: Keep-Alice ) 和 ( Keep-Alive: timeout=xxx, max=xxx )

(2) 管道化
- 不能解决对头阻塞

(3) 缓存
- Cache-Control
- HTTP1.0 --- Expires ----------- 绝对时间点
- HTTP1.1 --- Cache-Control ----- 相对时间段
- 优先级
  - Cache-Control > Expires
  - Cache-Control 更精确，不受本地绝对时间点的影响，因为时间段是一个差值
- Cache-Control: no-cache,private,public,max-age=xxxx
  - no-cache: 不强缓存
  - max-age: 缓存的时间段
  - private: 表示该资源仅仅属于发出请求的最终用户，这将禁止中间服务器（如代理服务器）缓存此类资源

(4) 断点续传
- 请求头: Range
- 响应头: Content-Range
- 原理
    - 上传/下载资源时，资源过大，将其分割为多个部分，分别上传/下载
    - 如果遇到网络故障，可以从已经上传/下载好的地方 ( 继续请求 )，不用从头开始，提高效率
    - 总结：一共两个特点：即 ( 断点 - 分片上传 ) 和 ( 续传 - 网络故障后回到原来上传和下载的地方继续进行 )
- 案例：
    - Range: bytes=0-801 ------------------ 表示第一个字节的位置是0，最后一个字节的位置是801
    - Content-Range: bytes 0-800/801 ------ 表示 响应覆盖范围 和 整个实体的长度
```

### (15) HTTP 2.0

```
HTTP 2.0 特点
---

1. 二进制分帧
- 作用：将数据转换成二进制，可以用来实现多路复用
- 原理：
  - 将 ( 应用层 ) 的数据进行 ( 二进制分帧 ) 处理，即将应用层的 ( 纯文本字符 转成 二进制 )
  - 将 ( 并发的多个不同HTTP请求 ) 拆成 ( 不同的stream流 )，通过 ( steam的id进行标记 )，发起一个HTTP请求即可
  - 请求的 ( stream流 ) 被分割成 ( 多种类型的帧 )，包括 ( `header帧` ) 和 ( `data帧` )
  - 因为可以通过stream帧的id标记不同的帧，可能保证可以将数据 ( 有序重组 )
  - 注意点：( 二进制分帧 ) 是在 ( 二进制帧层 ) 进行处理的，( 重组 ) 也是在二进制帧层进行处理的
- 总结
  - HTTP2.0引入了 ( 二进制帧层 )，将 ( 并发的请求 ) 转成不同的 ( stream流 )，每个stream流都有一个唯一的 ( id )，id保证了请求和响应的数据可以在 ( 二进制帧层进行重组 )，实现乱序发送
2. 多路复用

3. 头部压缩
- 将头部的 ( key:value ) 的文本，在发送端和接收端做了一层映射，发送的时只需要发送 ( key ) 就可以

4. 服务端推送
```

### (16) get 和 post 的区别？

- 作用
  - get 获取资源，post 新建/更新 资源
- 数据传输
  - get 通过 url 传输数据，post 通过 body 传输数据
- 幂等 和 安全性
  - get 幂等 安全
  - post 非幂等 不安全
- 缓存
  - get 的资源能被 浏览器 和 代理服务器 缓存
  - post 不能被浏览器 和 代理服务器缓存
- 书签
  - get 能被添加成书签
  - post 不能被添加成书签
- 数据类型
  - get 只允许 ASCII 字符
  - post 无限制
- tcp 数据包个数
  - get 产生一个 tcp 数据包，post 产生两个 tcp 数据包
  - get，浏览器会把 ( header 和 data ) 一并发送出去，服务器响应 200（返回数据）
  - post，浏览器( 先发送 header )，服务器响应 100 continue，浏览器 ( 再发送 data )，服务器响应 200 ok（返回数据）

### (17) put 和 post 的区别？

- 幂等性
  - put 幂等，一次和多次的效果一样
  - post 非幂等
- 资源
  - put 的 uri 指向 ( 单一资源 ) ---- 更新资源
  - post 指向 ( 集合资源 ) -------- 新建资源
- 总结
  - put 幂等，更新资源
  - post 非幂等，新建资源

### (18) put 和 patch 的区别？

- 相同点
  - put 和 patch 都是更新资源
- 不同点
  - patch 是局部更新
  - put 是整体更新

### (19) TCP/IP 协议分层

```
1
TCP/IP协议一共分为 4 层
- 应用层 ----------- HTTP --------------- 数据
- 传输层 ----------- TCP UDP ------------ 数据 + 端口号
- 网络层 ----------- IP ----------------- 数据 + 端口号 + IP地址 ------------ 设备( 路由器 - 网关 )
- 数据链路层 -------- MAC ---------------- 数据 + 端口号 + IP地址 + MAC地址 -- 设备 ( 交换机 )

- 物理层 ----------------------------------------------------------------- 设备 ( 光纤 )
- 如果还要加一层的话，就是 (物理层)，这样就一个有5层 ( 应用层->传输层->网络层->数据链路层->物理层 )


2
ip地址 和 mac地址
- ip地址 -------- 不固定
- mac地址 ------- 固定 -------- 每个网卡都有一个固定的mac地址
- 通过ip地址能找到mac地址，ip -> mac，从而找到具体的设备
- 【 注意：我们真正上网的时，目标的ip的值是不会变的，变的时候mac地址，通过不断的中转mac地址，最终找到目标设备 】
- 【 通过ARP协议将ip地址转成mac地址 】


3
不能通信：----------> 默认 ( 两个不同的网路 ) 是 ( 不能通信的 )
如何才能通信：-------> 如果想要在不同网路的两个设备能通信的话，需要 ( 网关 )
哪些设备可以做网关：--> 路由器
路由器：------------> 有两个端口 wan lan
- wan口用来上网
- lan用来做局域网 ( 局域网时，[网络层的路由器]就相当于[数据链路层的交换机]了 )，没有wan口的路由器相当于交换机


4
网络中的协议 - 协议：指的是 约定和规范
应用层协议：HTTP协议 DNS协议 DHCP协议
传输层协议：TCP协议 UDP协议
网络层协议：IP协议 ARP协议
注意：下层为上层提供服务


5
ARP协议：核心价值是将ip地址转成mac地址 - 做广播，缓存表
DHCP协议：动态主机配置协议，自动分配ip


6
DNS协议
- 英语：Domain Name System 域名系统
- 作用：将 ( 域名 ) 解析成 ( ip ) 地址
- 特点：
  - 1.DNS服务器会缓存 ( 域名和ip的对应关系 )，所以很快
  - 2.并且采用 UDP 方式进行通信，UDP面向无链接，TCP面向连接
- 域名
  - www.baidu.com.cn
  - 如何判断是几级域名
    - 有几个点就是几级域名，这里有三个点，就是三级域名
  - 查找顺序
    - 解析时，都是 ( 从右向左 ) 的解析域名，( 递归查找 )
    - 递归查找：顶级域名 -> 一级域名 -> 二级域名 -> ...

7
递归和迭代的区别
递归：a->b->c->b->a
迭代：a->b b->a a->c c->a
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8ce556cac5f43468d14505e1916f05a~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/784f77879d744176a7b1a88f98c99945~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c7fcf3bf657467487c909cd3a9c9ab0~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a075d2fd00a4a6da39bb4070ca98779~tplv-k3u1fbpfcp-watermark.image?)
