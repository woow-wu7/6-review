<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 执行上下文 作用域 执行上下文栈 作用域链

      // 1
      // 作用域
      // - 概念：作用域指 ( 变量和函数 ) 存在的范围
      // - 作用：( 隔离变量 )，不同作用域之间不存在 ( 变量污染 )
      // - 分类：
      //  - 全局作用域 - 全局变量，在任何地方都可以使用
      //  - 函数作用域 - 局部变量，在函数内可以访问，函数外不能访问
      //  - 块级作用域 - 代码块中生效
      // - 函数本身的作用域
      //   - 函数本身也是一个值，也有自己的作用域
      //   - 函数本身的作用域，是函数定义时的作用域，与函数调用时的作用域无关

      // 2
      // 执行上下文 ( 对象 )
      // - 分类
      //  - 全局执行上下文对象
      //  - 函数执行上下文对象
      //  - eval
      // - (1) 全局执行上下文
      //  - 1. 生成时机：在 ( 全局代码执行之前 )，将 ( window ) 确定为 ( 全局执行上下文对象 )
      //  - 2. 对全局数据进行 ( 预处理 )
      //    - 全局变量 ------------> 变量提升，并赋值为 undefined，同时作为顶层对象 window 的属性 ( 扩展：globalThis )
      //    - 全局函数 ------------> 函数提升，并赋值为 该函数，同时作为顶层对象 window 的属性
      //    - this --------------> 将 this 指向 window
      // - (2) 函数执行上下文
      //  - 1. 生成时机：在 ( 函数调用，并且函数体执行前 ) 创建 ( 函数执行上下文对象 )
      //  - 2. 对函数内的局部变量进行 ( 预处理 )
      //    - 形参 ---------------> 将行参赋值为 ( 实参 )，并添加为该函数执行上下文对象的属性
      //    - 局部变量 ------------> 变量提升，赋值为 undefined，并添加为该函数执行上下文对象的属性 -- ( 变量名存在 - 略过变量的声明，变量声明时会赋值undefined )
      //    - 局部函数 ------------> 将整个函数提升到头部，并作为该函数执行上下文对象的属性 ---------- ( 函数名存在，新的覆盖旧的 )
      //    - arguments对象 ------> 赋值，并添加为该函数执行上下文对象的属性
      //    - this --------------> 将 this 赋值为调用该函数的对象 ( this在调用时确定指向 )
      //  - 3. !!!!!!!! 优先级 !!!!!!!! 优先级 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      //    - 形参 > 函数声明 > 变量声明
      //    - 函数名存在 ----- 新的覆盖旧的
      //    - 变量名存在 ----- 直接略过变量声明

      // 3
      // 作用域 和 执行上下对象 的区别
      // - 1.形成的时机
      //  - 函数作用域：在函数 ( 声明 ) 时形成，且不会在变化
      //  - 函数执行上下文对象：在函数 ( 调用，并且在函数体执行前创建 )
      // - 2.静态/动态
      //  - 函数作用域：是静态的，在函数声明时形式，且不会在变化
      //  - 函数执行上下文：动态的，在函数调用并且函数体执行前形成函数执行上下文，每调用一次就形成一次函数执行上下文对象，在调用结束后释放
      // - 3.联系
      //  - 函数执行上下文对象 从属于 函数作用域
      //  - 只有在函数作用域形成，即函数声明后，才会形成函数执行上下文对象
      //  - 函数执行上下文对象 从属于 函数作用域
      //  - 全局执行上下文对象 从属于 全局作用域
      //  - 因为只有函数存在，才会在调用并函数体执行前创建函数执行上下文对象
      // --------------
      // xxx
      // 函数本身的作用域测试
      var a = 1;
      function aa() {
        console.log(a);
      }
      function bb() {
        var a = 2;
        aa();
        // 因为：函数本身的作用域，是函数定义时的作用域，与函数调用时的作用域无关
        // 所以：输出 1，而不是 2
      }
      bb();

      // --------------
      // yyy
      // 形参 函数声明 变量声明 的优先级
      // - 链接：https://www.yuque.com/woowwu/msyqpd/ph3qtd
      function fn1(name) {
        console.log(name);
        var name = 10;
        function name() {}
        console.log(name);
      }
      fn1("wang");
      // 上面的代码 相当于 下面的代码
      function fn1(name, age) {
        var name = "wang"; // 形参 赋值为 实参
        // var name = undefined // 1. 变量提升，变量名已经存在，直接略过变量的声明 2.变量提升是将变量赋值为undefined
        function name() {} // ---- 2. 函数提升，函数名已经存在，新的覆盖旧的，值为整个函数
        console.log(name); // function name() {}
        name = 10;
        console.log(name); // 10
      }
    </script>
  </body>
</html>
