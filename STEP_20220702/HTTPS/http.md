# HTTP

### (1) http 相关概念

- 定义
  - HyperText Transfer Protocol 超文本传输协议
  - HyperText：是超文本的意思
  - 含义：http 是超文本传输协议 ( 传输的内容是超文本 )，除了传输文本，还能传输图片，视频等资源
  - html：html 就是常见的超文本

### (2) TCP/IP 协议分层 --- 这里是 4 层模型

- 应用层 ------------- HTTP HTTPS DNS ------ 数据
- 传输层 ------------- TCP UDP ------------- 数据 + 端口号
- 网络层 ------------- IP ARP -------------- 数据 + 端口号 + IP 地址 ----------- ( 设备：路由器，网关 )
- 数据链路层 -------------------------------- 数据 + 端口号 + IP 地址 + MAC 地址 -- ( 设备：交换机 )
- 下层为上层提供服务

### (3) TCP 报文

- 相关概念
  - Sep ------------ 序号
  - Ack ------------ 确认号
  - Seq = Ack + 1 ( 序号=确认号+1 )
  - 标志位
    - ACK ---------- 确认链接
    - SYN ---------- 建立链接
    - FIN ---------- 释放链接
  - 注意点
    - Ack 是确认号
    - ACK 是标志位，表示确认链接
    - 只有标志位 ACK=1 时，确认号 Ack 才有效

### (4) 网关 ( 路由器 )

- 网关的作用
  - 因为：正常情况下，两个 ( 不同的网络 ) 是 ( 不能进行通信 ) 的
  - 所以：需要 ( 网关 )，不同网络的两个设置才能进行通信
  - 路由器：路由器就可以作为 ( 网关 )
- 路由器
  - 路由器就是网关
  - wan：用来上网
  - lan：用来做 ( 局域网 )

### (5) 一些常见的协议

- ARP 协议
  - 作用：将 ( IP 地址 ) 转成 ( MAC 地址 )
  - 原来：做广播 和 缓存
- DHCP 协议
  - 作用：自动分配 IP
- DNS 协议
  - 英文：Domain Name System 域名系统
  - 作用：将 ( 域名 ) 解析成 ( IP 地址 )
  - 特点：
    - 1. DNS 服务器会缓存 ( 域名 和 IP ) 之间的映射关系，查找很快
    - 2. 采用 UDP 的方式进行通信，因为 UDP 面向无链接，所以很快
  - 查找顺序
    - 1. 解析时都是 ( 从右向左 ) 的解析域名，( 递归查找 )
    - 2. 查找顺序：顶级域名 -> 一级域名 -> 二级域名

### (6) 递归 和 迭代 的区别？

- 递归：a -> b -> c -> b -> a
- 迭代：a->b->a a->c->a

### (7) HTTP 三次握手

- 第一次握手
  - 发送：客户端发送 ( 标志位 SYN = 1， 序号 Seq = x ) 的 ( 链接请求 ) 到服务器
  - 状态：发送后，客户端的状态由 ( close -> SYN_SENT )
- 第二次握手
  - 发送：服务器发送 ( 标志位 ACK=1，确认号 Ack=x+1, 序号 Seq=y ) 的 ( 确认请求 ) 到客户端
  - 状态：发送后，服务器的状态由 ( close -> SYN_RECEIVED )
- 第三次握手
  - 发送：客户端发送 ( 标志位 ACK=1，序号 Sep=x+1，确认号 Ack=y+1 ) 的 ( 确认请求 ) 到服务器
  - 状态：发送后 ( 客户端和服务器 ) 两者的状态都是 ( established ) 链接状态
- 为什么需要第三次握手
  - 原因一
    - 第一次：服务器能确定：客户端的发送能力正常，自己的接受能力正常
    - 第二次：
      - 客户端能确定：自己的发送接受能力正常，服务器的发送接受能力正常
      - 但是服务器不能确定：客户端的接受能力是否正常，所以需要第三次握手
    - 第三次
      - 服务端能确定：自己的发送接受能力正常，客户端的发送接受能力也正常
  - 原因二
    - 为了实现可靠传输
    - 三次握手的过程，是通信双方 ( 相互告知序列号起始值 )，并确认对方已经收到了

### (8) HTTP 四次挥手

- 第一次挥手
  - 发送：客户端发送一个标志位 FIN=1，Seq=u 的释放链接到服务器
  - FIN：表示包发送完毕，但是还可以接受包
  - 状态：establish -> FIN_WAIT1
- 第二次挥手
  - 发送：服务器向浏览器发送一个标志位 ACK=1，Seq=v，Ack=u+1 的确认包给浏览器
  - 状态：establish -> CLOSE_WAIT
- 第三次挥手
  - 发送：服务器再次向浏览器发送一个标志位 FIN=1，ACK=1，Seq=w, Ack=u+1 到服务器
  - 状态：CLOSE_WAIT -> LAST_ACK
- 第四次挥手
  - 发送：浏览器向服务器发送一个标志位 ACK=1，Seq=v+1, Ack=w+1 的确认链接到服务器
  - 状态：FIN_WAT1 -> FIN_WAIT2
  - 状态：TIME_WAIT -> CLOSE

### (9) HTTP 状态码

```
100 continue
101 switch protocol

200 ok
204 no content
206 partial content

301 move permanently
302 found
303 sea other
304 not modified 资源未被修改，协商缓存
307 temporary redirect

400 bad Request
401 unauthorized 未授权
403 forbidden 权限不够
404 not found 资源未找到
405 method not allow 请求方法错误

500 internal server error
502 bad gateway
503 service Unavailable
504 gateway time out
```

### (10) HTTP 的缺点

- 明文传播，可能会被 -------------- 窃听
- 不验证通信双方的身份，可能会遭遇 -- 伪装
- 不验证报文的完整性，可能会被 ------ 篡改

### (11) HTTP 报文

- HTTP 报文 = 报文首部 + 空行 + 报文主体
- 请求报文首部 = 请求行 + 请求头
- 响应报文首部 = 状态行 + 响应头
- 请求行 = 请求的方法 + url + HTTP 版本号
- 状态行 = HTTP 版本号 + 状态码 + 原因短语

### (12) HTTPS 加密的过程

- ( 服务器 ) 把自己的 ( 公钥 ) 发给证书颁发机构
- ( 证书颁发机构 ) 用自己的 ( 私钥 ) 对 ( 服务器的公钥 ) 进行数字签名，生成 ( 公钥证书 )
- 服务器把证书发给浏览器
- ( 浏览器 ) 用 ( 内置在浏览器上的证书颁发结构的 - 公钥 ) 解密 ( 公钥证书 ) 获得 ( 服务器的公钥 )
- ( 浏览器用获取的服务器的公钥 - 加密 - 对称加密通信时需要的密钥 ) 发给 ( 服务器 )
- ( 服务器 ) 用自己的 ( 私钥 ) 解密 ( 获取对称加密通信时的 - 密钥 )
- 之后就可以进行对称加密通信了

### (13) HTTPS 的握手过程

- 浏览器 -> client hello -> 服务器

- 浏览器 <- server hello <- 服务器
- 浏览器 <- certificate <- 服务器
- 浏览器 <- server hello done <- 服务器

- 浏览器 -> client key exchange -> 服务器
- 浏览器 -> change cipher spec -> 服务器
- 浏览器 -> finished -> 服务器

- 浏览器 <- change cypher spec <- 服务器
- 浏览器 <- finished <- 服务器

- 之后就可以进行 HTTP 通信了
